@* @model Spiro_Andon.Models.Quality *@
@model IEnumerable<Spiro_Andon.Models.Quality>
@{
    ViewData["Title"] = "Quality Policy";
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <title>Quality Form</title>
    <script>
       
        function showPopup(message) {
            alert(message);
        }
    </script>
</head>
<body>

    <div class="container" style="margin-left: -65px; min-width: 1640px;">
        <div class="row">
            <!-- Card 1 -->
            <div class="col-md-3">
                <div class="card animated-border" style="margin-bottom: 20px;">
                    <div class="card-body d-flex align-items-center">
                        <div style="
                        width: 70px;
                        height: 70px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-size: 30px;
                        background-color: #007bff;
                        color: white;
                        margin-right: 15px;">
                            <i class="bi bi-bar-chart-fill"></i>
                        </div>
                        <div>
                            <h6 class="card-title">Total</h6>
                            <h6 id="" class="text-left">Loading...</h6>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 2 -->
            <div class="col-md-3">
                <div class="card animated-border" style="margin-bottom: 20px;">
                    <div class="card-body d-flex align-items-center">
                        <div style="
                        width: 70px;
                        height: 70px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-size: 30px;
                        background-color: #007bff;
                        color: white;
                        margin-right: 15px;">
                            <i class="bi bi-bar-chart-fill"></i>
                        </div>
                        <div>
                            <h6 class="card-title">Minor </h6>
                            <h6 id="" class="text-left">Loading...</h6>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 3 -->
            <div class="col-md-3">
                <div class="card animated-border" style="margin-bottom: 20px;">
                    <div class="card-body d-flex align-items-center">
                        <div style="
                        width: 70px;
                        height: 70px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-size: 30px;
                        background-color: #007bff;
                        color: white;
                        margin-right: 15px;">
                            <i class="bi bi-bar-chart-fill"></i>
                        </div>
                        <div>
                            <h6 class="card-title">Major </h6>
                            <h4 id="" class="text-left">Loading...</h4>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card 4 -->
            <div class="col-md-3">
                <div class="card animated-border" style="margin-bottom: 20px;height:105px;">
                    <div class="card-body d-flex align-items-center">
                        <div style="
                        width: 70px;
                        height: 70px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-size: 30px;
                        background-color: #dc3545;
                        color: white;
                        margin-right: 15px;">
                            <i class="bi bi-speedometer2"></i>
                        </div>
                        <div>
                            <h4 class="card-title">Live OEE %</h4>
                            <p>90%</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>



    <div style="display: flex; justify-content: space-between; gap: 20px; margin: 20px;margin-top:10px;min-width:1610px;margin-left:-50px;">
        <!-- Form Section -->
        <div style="flex: 1; border: 1px solid #ccc; padding: 20px; border-radius: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); height: 650px;">
            <h4 style="text-align: center; margin: 0 auto 20px; font-family: Arial, sans-serif; color: white; background-color: cadetblue; padding: 10px; border-radius: 5px; margin-top: 10px; width: 90%;">
                Quality Reporting Form
            </h4>
            <form action="/Home/QualityForm" method="post" style="margin-top: 10px; width: 90%; margin: 0 auto;">
                <div style="margin-bottom: 15px;">
                    <label for="textbox1" style="display: block; font-weight: bold; margin-bottom: 5px;">VIN Number:</label>
                    <input type="text" id="textbox1" name="Textbox1" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 15px;">      
                    <label for="textbox2" style="display: block; font-weight: bold; margin-bottom: 5px;">Checked By:</label>
                    <input type="text" id="textbox2" name="Textbox2" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="combobox" style="display: block; font-weight: bold; margin-bottom: 5px;">Defect Type:</label>
                    <select id="combobox" name="Combobox" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px;">
                        <option value="">-- Select --</option>
                        <option value="Option1">Option 1</option>
                        <option value="Option2">Option 2</option>
                        <option value="Option3">Option 3</option>
                    </select>
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="datepicker" style="display: block; font-weight: bold; margin-bottom: 5px;">Select Date:</label>
                    <input type="date" id="datepicker" name="Datepicker" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label for="description" style="display: block; font-weight: bold; margin-bottom: 5px;">Description:</label>
                    <textarea id="description" name="Description" rows="4" style="width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 5px; font-size: 14px;"></textarea>
                </div>
                <div>
                    <button type="submit" style="width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 5px; font-weight: bold; cursor: pointer; font-size: 16px;">
                        Submit
                    </button>
                </div>
            </form>
        </div>

       


        <!-- GridView Section -->
        <div style="flex: 2; margin-left: 20px;">
            <!-- Date Range Filter Form -->
            <div class="d-flex align-items-center mb-4">
                <!-- Start Date Picker -->
                <div class="me-3">
                    <label for="startDate" class="form-label">Start Date</label>
                    <input type="date" id="startDate" class="form-control" />
                </div>

                <!-- End Date Picker -->
                <div class="me-3">
                    <label for="endDate" class="form-label">End Date</label>
                    <input type="date" id="endDate" class="form-control" />
                </div>

                <!-- Filter Button -->
                <div>
                    <button id="filterBtn" class="btn btn-primary mt-4">Filter Reports</button>
                </div>
            </div>

            <!-- Table Container -->
            <div style="max-height: 550px; overflow-y: auto; border: 1px solid #ddd; border-radius: 5px; padding: 10px;">
                <table id="qualityTable" class="table table-bordered" style="width: 100%; font-size: 14px;">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>VIN</th>
                            <th>Checked By</th>
                            <th>Defect Type</th>
                            <th>Date</th>
                            <th>Description</th>
                        
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null)
                        {
                            foreach (var report in Model)
                            {
                                <tr>
                                    <td>@report.Id</td>
                                    <td>@report.VIN</td>
                                    <td>@report.CheckedBy</td>
                                    <td>@report.DefectType</td>
                                    <td>@report.Date.ToShortDateString()</td>
                                    <td>@report.Description</td>
                             
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="7" class="text-center">No data available</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>


            <!-- Buttons Section (Added below the table) -->
            <div class="d-flex justify-content-end mt-4">
                <!-- Button 1 -->
                <button id="editBtn" class="btn btn-secondary me-2">Edit</button>
                <!-- Button 2 -->
                <button id="deleteBtn" class="btn btn-danger">Delete</button>
            </div>

        </div>




   </div>




</body>
</html>

<script>

    document.querySelector("form").addEventListener("submit", function (e) {
        const vin = document.getElementById("textbox1").value.trim();
        const checkedBy = document.getElementById("textbox2").value.trim();
        const defectType = document.getElementById("combobox").value;
        const date = document.getElementById("datepicker").value;
        const description = document.getElementById("description").value.trim();

        // Check if all fields are filled
        if (!vin || !checkedBy || !defectType || !date || !description) {
            e.preventDefault(); // Prevent form submission
            alert("Please fill in all required fields.");
            return;
        }
    });


   

    // Function to fetch and display quality reports
    async function fetchQualityReports(startDate = null, endDate = null) {
        try {
            let url = '/Home/GetQualityReports';
            if (startDate && endDate) {
                url += `?startDate=${startDate}&endDate=${endDate}`;
            }

            const response = await fetch(url);
            const data = await response.json();

            const tableBody = document.querySelector("#qualityTable tbody");
            tableBody.innerHTML = "";

            if (data.length === 0) {
                tableBody.innerHTML = `<tr><td colspan="7" class="text-center">No data available</td></tr>`;
                return;
            }

            data.forEach(report => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${report.id}</td>
                    <td>${report.vin}</td>
                    <td>${report.checkedBy}</td>
                    <td>${report.defectType}</td>
                    <td>${new Date(report.date).toISOString().slice(0, 10)}</td>
                    <td>${report.description}</td>
                    
                `;
                tableBody.appendChild(row);
            });

            attachEditEvents(); // Reattach edit events
        } catch (error) {
            console.error("Error fetching quality reports:", error);
        }
    }



    // Fetch reports on page load
    document.addEventListener('DOMContentLoaded', () => {
        fetchQualityReports();

        document.querySelector('#filterBtn').addEventListener('click', () => {
            const startDate = document.querySelector('#startDate').value;
            const endDate = document.querySelector('#endDate').value;
            fetchQualityReports(startDate, endDate);
        });
    });
</script>
