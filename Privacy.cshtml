@model IEnumerable<Spiro_Andon.Models.Incident_Report>

@{
    ViewData["Title"] = "Privacy Policy";
}


    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
          rel="stylesheet" />


    <style>
        .animated-border {
            border: 1px solid;
            border-image-slice: 1;
            animation: borderAnimation 5s linear infinite;
          
            border-radius: 15px;
            flex-basis: 23%;
            flex-grow: 0;
            transition: transform 0.3s ease;
        }

            .animated-border:hover {
                transform: scale(1.05);
            }

        .card-wrapper {
            margin-left: 0;
            margin-right: 0;
            padding: 20px;
            display: flex;
            flex-wrap: nowrap;
            gap: 10px;
            overflow-x: auto;
        }

            .card-wrapper .animated-border:first-child {
                margin-left: 10px; 
            }

            .card-wrapper .animated-border:last-child {
                margin-right: -1px; 
            }
    </style>

 
   

@* <div class="container" style="margin-left: -20px;min-width:1600px;">
    <div class="row">
        <!-- Card 1 -->
        <div class="col-md-3">
            <div class="card animated-border" style="margin-bottom: 20px;">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="bi bi-bar-chart-fill me-2 text-primary"></i> Total Incident
                    </h5>
                    <h2 id="totalIncidentCount" class="text-left">Loading...</h2>
                </div>
            </div>
        </div>

        <!-- Card 2 -->
        <div class="col-md-3">
            <div class="card animated-border" style="margin-bottom: 20px;">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="bi bi-bar-chart-fill me-2 text-primary"></i> Minor Incidents
                    </h5>
                    <h2 id="minorIncidentCount" class="text-left">Loading...</h2>
                </div>
            </div>
        </div>
    
        <!-- Card 3 -->

        <div class="col-md-3">
            <div class="card animated-border" style="margin-bottom: 20px;">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="bi bi-bar-chart-fill me-2 text-primary"></i> Major Incidents
                    </h5>
                    <h2 id="majorIncidentCount" class="text-left">Loading...</h2>
                </div>
            </div>
        </div>
    

        <!-- Card 4 -->
        <div class="col-md-3">
            <div class="card animated-border" style="margin-bottom: 20px;">
                <!-- Increased margin-bottom -->
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="bi bi-speedometer2 me-2 text-danger"></i> Live OEE %
                    </h5>
                    <p>90%</p>
                </div>
            </div>
        </div>
    </div>
</div>
 *@




<div class="container" style="margin-left: -20px; min-width: 1600px;">
    <div class="row">
        <!-- Card 1 -->
        <div class="col-md-3">
            <div class="card animated-border" style="margin-bottom: 20px;">
                <div class="card-body d-flex align-items-center">
                    <div style="
                        width: 70px;
                        height: 70px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-size: 30px;
                        background-color: #007bff;
                        color: white;
                        margin-right: 15px;">
                        <i class="bi bi-bar-chart-fill"></i>
                    </div>
                    <div>
                        <h6 class="card-title">Total Incident</h6>
                        <h2 id="totalIncidentCount" class="text-left">Loading...</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card 2 -->
        <div class="col-md-3">
            <div class="card animated-border" style="margin-bottom: 20px;">
                <div class="card-body d-flex align-items-center">
                    <div style="
                        width: 70px;
                        height: 70px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-size: 30px;
                        background-color: #007bff;
                        color: white;
                        margin-right: 15px;">
                        <i class="bi bi-bar-chart-fill"></i>
                    </div>
                    <div>
                        <h6 class="card-title">Minor Incidents</h6>
                        <h2 id="minorIncidentCount" class="text-left">Loading...</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card 3 -->
        <div class="col-md-3">
            <div class="card animated-border" style="margin-bottom: 20px;">
                <div class="card-body d-flex align-items-center">
                    <div style="
                        width: 70px;
                        height: 70px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-size: 30px;
                        background-color: #007bff;
                        color: white;
                        margin-right: 15px;">
                        <i class="bi bi-bar-chart-fill"></i>
                    </div>
                    <div>
                        <h6 class="card-title">Major Incidents</h6>
                        <h2 id="majorIncidentCount" class="text-left">Loading...</h2>
                    </div>
                </div>
            </div>
        </div>

        <!-- Card 4 -->
        <div class="col-md-3">
            <div class="card animated-border" style="margin-bottom: 20px;">
                <div class="card-body d-flex align-items-center">
                    <div style="
                        width: 70px;
                        height: 70px;
                        display: flex;
                        align-items: center;
                        justify-content: center;
                        border-radius: 50%;
                        font-size: 30px;
                        background-color: #dc3545;
                        color: white;
                        margin-right: 15px;">
                        <i class="bi bi-speedometer2"></i>
                    </div>
                    <div>
                        <h6 class="card-title">Live OEE %</h6>
                        <p>90%</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>











<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />

<style>
    .form-container {
        margin: 50px auto;
        max-width: 542px;
        margin-left:100px;
        padding: 20px;
        background-color: #f9f9f9;
        border-radius: 10px;
        box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }

        .form-container h2 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
        }

    .btn-primary {
        width: 100%;
    }

    .alert {
        margin-top: 20px;
    }
</style>

<div class="container">
    <!-- Display TempData Messages -->
    @if (TempData["SuccessMessage"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show" role="alert">
            @TempData["SuccessMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["ErrorMessage"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show" role="alert">
            @TempData["ErrorMessage"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }

    <!-- Form Container -->
    <div class="form-container">
        <h2>Insert Incident Report</h2>
        <form asp-controller="Home" asp-action="InsertIncident" method="post">

            <div class="mb-3">

                <input type="hidden" id="ticketId" name="ticketId" />

            </div>

            <!-- Employee ID -->
            <div class="mb-3">
                <label for="EmpID" class="form-label">Employee ID</label>
                <input type="text" id="EmpID" name="EmpID" class="form-control" placeholder="Enter employee ID" required />
            </div>

            <!-- Employee Name -->
            <div class="mb-3">
                <label for="EmpName" class="form-label">Employee Name</label>
                <input type="text" id="EmpName" name="EmpName" class="form-control" placeholder="Enter employee name" required />
            </div>

            <!-- Date of Incident -->
            <div class="mb-3">
                <label for="DateOfIncident" class="form-label">Date of Incident</label>
                <input type="date" id="DateOfIncident" name="DateOfIncident" class="form-control" required />
            </div>

            <!-- Type of Incident -->
            <div class="mb-3">
                <label for="IncidentType" class="form-label">Type of Incident</label>
                <select id="IncidentType" name="IncidentType" class="form-select" required>
                    <option value="" disabled selected>Choose type of incident</option>
                    <option value="Major Incident">Major Incident</option>
                    <option value="Minor Incident">Minor Incident</option>
                    <option value="Fist Aid">Fist Aid</option>
                    <option value="Other">Other</option>
                </select>
            </div>

            <!-- Description -->
            <div class="mb-3">
                <label for="Description" class="form-label">Description</label>
                <textarea id="Description" name="Description" class="form-control" rows="5" placeholder="Describe the incident in detail" required></textarea>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn btn-primary">Submit</button>
       
        </form>
    </div>

    
   @*  data gridview *@

    <div class="grid-container" style="margin-left: 500px; width: 1050px; max-height: 400px; overflow-y: auto; border: 1px solid #ddd; margin-top: 25px;">
        <table class="table table-striped table-bordered" style="width: 100%; table-layout: fixed;">
            <thead style="position: sticky; top: 0; z-index: 1000; background-color: #343a40; color: #fff;">
                <tr>
                    <th style="max-width: 50px; padding: 10px; text-align: left;">Ticket ID</th>
                    <th style="max-width: 100px; padding: 10px; text-align: left;">Employee ID</th>
                    <th style="max-width: 150px; padding: 10px; text-align: left;">Employee Name</th>
                    <th style="max-width: 120px; padding: 10px; text-align: left;">Date of Incident</th>
                    <th style="max-width: 150px; padding: 10px; text-align: left;">Type of Incident</th>
                    <th style="max-width: 300px; padding: 10px; text-align: left;">Description</th>
                </tr>
            </thead>
            <tbody>
                @if (Model?.Any() == true)
                {
                    foreach (var report in Model)
                    {
                        <tr>
                            <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;cursor: pointer; padding: 10px;" onclick="populateForm(@report.Id)">@report.Id</td>
                            <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;padding: 10px;">@report.EmpID</td>
                            <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;padding: 10px;">@report.EmpName</td>
                            <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;padding: 10px;">@report.DateOfIncident</td>
                            <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;padding: 10px;">@report.IncidentType</td>
                            <td style="overflow: hidden; text-overflow: ellipsis; white-space: nowrap;padding: 10px;">@report.Description</td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6" style="padding: 10px; text-align: center;">No incident reports available.</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
    <!-- Section for Actions -->
    <div class="action-container" style="margin-left: 500px; width: 1000px; margin-top: 20px; border: 1px solid #ddd; padding: 15px; min-height: 200px;">
        <!-- Header Section -->
        <div class="header-section text-center" style="margin-bottom: 30px; background-color:cadetblue;">
            <h5 style="margin: 0; font-weight: bold;color:white;">Search Incident History</h5>
        </div>

        <form id="incidentForm">
            <div class="row">
                <!-- Left Date Picker -->
                <div class="col-md-3 d-flex align-items-center">
                    <label for="datePicker1" class="me-3">Start Date:</label>
                    <input type="date" id="datePicker1" class="form-control" style="max-width: 200px;" />
                </div>

                <!-- Right Date Picker -->
                <div class="col-md-3 d-flex align-items-center">
                    <label for="datePicker2" class="me-3">End Date:</label>
                    <input type="date" id="datePicker2" class="form-control" style="max-width: 200px;" />
                </div>
            </div>

            <div class="text-center" style="display: flex; justify-content: space-between; max-width: 1000px; margin: auto; gap: 10px; margin-top: 50px;">
                <button type="button" style="width: 300px; background-color:darkcyan;" class="btn btn-danger" onclick="ShowReport()">View Report</button>
                <button type="button"
                        style="width: 300px; background-color: darkorange;"
                        class="btn btn-danger"
                        onclick="updateIncident()">
                    Update
                </button>
                <button type="button" style="width: 300px;" class="btn btn-danger" onclick="DeleteReport()">Delete</button>
            </div>
        </form>
    </div>





</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>




     document.addEventListener("DOMContentLoaded", function () {
        fetch('/Home/GetTotalIncidentCount') // Replace with your actual endpoint
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Update the count in the UI
                    document.getElementById('totalIncidentCount').textContent = data.totalIncidents;
                } else {
                    document.getElementById('totalIncidentCount').textContent = "Error";
                    console.error(data.message);
                }
            })
            .catch(error => {
                document.getElementById('totalIncidentCount').textContent = "Error";
                console.error('Error fetching total incident count:', error);
            });
    });

        document.addEventListener("DOMContentLoaded", function () {
        fetch('/Home/GetMinorIncidentCount') // Replace 'ControllerName' with your actual controller name
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById("minorIncidentCount").textContent = data.count;
                } else {
                    document.getElementById("minorIncidentCount").textContent = "Error";
                    console.error(data.message);
                }
            })
            .catch(error => {
                document.getElementById("minorIncidentCount").textContent = "Error";
                console.error("An error occurred:", error);
            });
    });
        document.addEventListener("DOMContentLoaded", function () {
        fetch('/Home/GetMajorIncidentCount') // Replace 'ControllerName' with your actual controller name
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById("majorIncidentCount").textContent = data.count;
                } else {
                    document.getElementById("majorIncidentCount").textContent = "Error";
                    console.error(data.message);
                }
            })
            .catch(error => {
                document.getElementById("majorIncidentCount").textContent = "Error";
                console.error("An error occurred:", error);
            });
    });




        function ShowReport() {
        const startDate = document.getElementById("datePicker1").value;
        const endDate = document.getElementById("datePicker2").value;

        if (startDate && endDate) {
            window.location.href = `/Home/Privacy?startDate=${startDate}&endDate=${endDate}`;
        } else {
            alert("Please select both start and end dates.");
        }
    }

    function populateForm(ticketId) {
        fetch(`/Home/GetIncidentById?id=${ticketId}`)
            .then(response => response.json())
            .then(data => {
                if (data) {
                    document.getElementById("EmpID").value = data.empID;
                    document.getElementById("EmpName").value = data.empName;
                    document.getElementById("DateOfIncident").value = data.dateOfIncident.split("T")[0];
                    document.getElementById("IncidentType").value = data.incidentType;
                    document.getElementById("Description").value = data.description;
                    document.getElementById("ticketId").value = data.id;
                } else {
                    alert("Data not found!");
                }
            })
            .catch(error => console.error("Error:", error));
    }

         function updateIncident() {
        // Gather data from the form fields
        const report = {
            Id: document.getElementById("ticketId").value,
            EmpID: document.getElementById("EmpID").value,
            EmpName: document.getElementById("EmpName").value,
            DateOfIncident: document.getElementById("DateOfIncident").value,
            IncidentType: document.getElementById("IncidentType").value,
            Description: document.getElementById("Description").value
        };

        // Encode the data as query parameters
        const queryString = new URLSearchParams(report).toString();

        // Send the data to the server using a GET request
        const url = `/Home/UpdateIncident?${queryString}`;

        fetch(url, { method: 'GET' })
            .then(response => {
                if (!response.ok) {
                    throw new Error("Network response was not ok");
                }
                return response.json();
            })
            .then(data => {
                if (data.success) {
                    alert("Incident updated successfully!");
                    // Optionally refresh data or redirect
                } else {
                    alert(`Failed to update incident: ${data.error}`);
                }
            })
            .catch(error => {
                console.error("Error:", error);
                alert("An error occurred while updating the incident.");
            });
    }






</script>